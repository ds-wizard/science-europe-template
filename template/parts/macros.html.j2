{% set km = dmp.knowledgeModel %}
{% set replies = dmp.questionnaireReplies %}
{% set repliesMap = dmp.questionnaireRepliesMap %}
{% set report = dmp.report %}
{% set metricDefinitions = dmp.metrics %}
{% set levelDefinitions = dmp.levels %}

{% macro renderCurrentLevel() %}
  {% for levelDefinition in levelDefinitions %}
    {% if levelDefinition.level == dmp.level %}
      {{levelDefinition.title}}
    {% endif %}
  {% endfor %}
{% endmacro %}

{# Formatting macros #}
{%- macro formatEmail(email) -%}
  <span class="contact-email"><a href="mailto:{{ email }}">{{ email }}</a></span>
{%- endmacro -%}

{%- macro formatOrcid(orcid) -%}
  <span class="contact-orcid"><span class="mini-orcid-icon-16"></span> {{ orcid }}</span>
{%- endmacro -%}

{%- macro integrationValue(reply, questionUuid) -%}
  {%- if reply.value.value.type == "IntegrationValue" -%}
    {%- set question = km.entities.questions[questionUuid] -%}
    {%- set integration = km.entities.integrations[question.integrationUuid] -%}
    {%- set integrationLink = replace(integration.itemUrl, "${id}", reply.value.value.id) -%}
    <a href="{{ integrationLink }}" target="_blank">{{ reply.value.value.value }}</a>
  {%- else %}
    {{ reply.value.value.value }}
  {%- endif -%}
{%- endmacro -%}
