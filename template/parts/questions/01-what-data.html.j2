<div id="q-what-data" class="question">
  <h3>What data will you collect or create?</h3>
  {%- scope -%}
  <div class="answer">

            
  {# Create/collected data #}
  {%- set measuredDataPath = join([creatingCUuid, measuredDataQUuid], ".") -%}
  {%- set measuredDataCount = repliesMap[measuredDataPath].value.value -%}
  {# Measured datasets #}
  {%- if measuredDataCount > 0 -%}
    <div>
    <h4>Instrument datasets</h4>
    The following instrument datasets will be acquired in the project:
    <ul>
      {%- for datasetIndex in range(measuredDataCount - 1) -%}
        {%- set pathPrefix = join([measuredDataPath, datasetIndex], ".") -%}
        <li>
          {%- set measuredDataNamePath = join([pathPrefix, measuredDataNameQUuid], ".") -%}
          {%- set measuredDataName = repliesMap[measuredDataNamePath].value.value -%}
          {%- set measuredDataWhoPath = join([pathPrefix, measuredDataWhoQUuid], ".") -%}
          {%- set measuredDataWhoAUuid = repliesMap[measuredDataWhoPath].value.value -%}
          {%- set measuredDataEquipPath = join([pathPrefix, measuredDataEquipQUuid], ".") -%}
          {%- set measuredDataEquipAUuid = repliesMap[measuredDataEquipPath].value.value -%}
          <strong>{{ measuredDataName ? measuredDataName : "(no name given)" }}</strong>
          {# Who will collect #}
          {%- if measuredDataWhoAUuid == measuredDataWhoExpertsOwnAUuid -%}
            <p>This dataset will be collected by experts in the project, with our own equipment.</p>
          {%- elif measuredDataWhoAUuid == measuredDataWhoExpertsOutAUuid -%}
            <p>This dataset will be collected by experts in the project, at a specialized infrastructure.</p>
          {%- elif measuredDataWhoAUuid == measuredDataWhoExternalAUuid -%}
            {%- set mdExternalOwnershipPath = join([measuredDataWhoPath, measuredDataWhoExternalAUuid, mdExternalOwnershipQUuid], ".") -%}
            {%- set mdExternalOwnershipAUuid = repliesMap[mdExternalOwnershipPath].value.value -%}
            <p>
              This dataset will be collected by an external party.
              {% if mdExternalOwnershipAUuid == mdExternalOwnershipPartyAUuid -%}
                The ownership of the resulting data will remain with the external party.
              {%- elif mdExternalOwnershipAUuid == mdExternalOwnershipPartnersAUuid -%}
                The project partners acquire full ownership of the data.
              {%- elif mdExternalOwnershipAUuid == mdExternalOwnershipOtherAUuid -%}
                {%- set mdExternalOwnershipOtherPath = join([mdExternalOwnershipPath, mdExternalOwnershipOtherAUuid, mdExternalOwnershipOtherQUuid], ".") -%}
                {%- set mdExternalOwnershipOther = repliesMap[mdExternalOwnershipOtherPath].value.value -%}
                {%- if mdExternalOwnershipOther -%}
                  For the ownership of the data we have made the following arrangements: {{ mdExternalOwnershipOther }}{{ endswith(mdExternalOwnershipOther, ".") ? "" : "." }}
                {%- endif -%}
              {%- endif -%}
            </p>
          {%- endif -%}
          {# Equipment standard? #}
          {% if measuredDataEquipAUuid == measuredDataEquipDescribedAUuid -%}
            <p>The equipment is very well described and known.</p>
          {%- elif measuredDataEquipAUuid == measuredDataEquipCareAUuid -%}
            <p>The equipment is less well described or not completely standard, so we will need to take extra care documenting the process.</p>
          {%- endif -%}
        </li>
      {%- endfor -%}
    </ul>
    </div>
  {%- endif -%}
  {# Non-equipment datasets #}
  {%- set neqDataPath = join([creatingCUuid, neqDataQUuid], ".") -%}
  {%- set neqDataAUuid = repliesMap[neqDataPath].value.value -%}
  {%- if neqDataAUuid == neqDataYesAUuid -%}
    {%- set neqDataPrefix = join([neqDataPath, neqDataYesAUuid], ".") -%}
    {%- set neqDataQuestPath = join([neqDataPrefix, neqDataQuestQUuid], ".") -%}
    {%- set neqDataQuestAUuid = repliesMap[neqDataQuestPath].value.value -%}
    {%- set neqDataCaseReportPath = join([neqDataPrefix, neqDataCaseReportQUuid], ".") -%}
    {%- set neqDataCaseReportAUuid = repliesMap[neqDataCaseReportPath].value.value -%}
    {%- set neqDataERecordsPath = join([neqDataPrefix, neqDataERecordsQUuid], ".") -%}
    {%- set neqDataERecordsAUuid = repliesMap[neqDataERecordsPath].value.value -%}
    {%- set neqDataSetsPath = join([neqDataPrefix, neqDataSetsQUuid], ".") -%}
    {%- set neqDataSetsCount = repliesMap[neqDataSetsPath].value.value -%}
    {%- scope -%}
    {%- set questionnaires = neqDataQuestAUuid == neqDataQuestYesAUuid -%}
    {%- set caseReport = neqDataCaseReportAUuid == neqDataCaseReportYesAUuid -%}
    {%- set eRecords = neqDataERecordsAUuid == neqDataERecordsYesAUuid -%}
    {%- if questionnaires || caseReport || eRecords || neqDataSetsCount > 0 -%}
      <div>
      <h4>Non-equipment datasets</h4>
      {# Types #}
      {%- set typesBools = [questionnaires, caseReport, eRecords] -%}
      {%- set typesNames = ["questionnaires", "case report forms", "electronic patient records"] -%}
      {%- set types = map(filter(zip(typesBools, typesNames), (x) -> x[0]), (x) -> x[1]) -%}
      {%- set typesCount = length(types) -%}
      <p>
        {%- if typesCount > 0 -%}
          We also collect data from
          {% if typesCount == 1 -%}
              {{ types[0] }}.
          {%- elif typesCount == 2 -%}
              {{ types[0] }} and {{ types[1] }}.
          {%- else -%}
              {{ join(slice(types, 0, length(types)-1), ", ") }}, and {{ slice(types, -1) }}.
          {%- endif -%}
        {% endif %}
        {# Datasets #}
        {%- if neqDataSetsCount > 0 -%}
          The non-equipment datasets are:
          <ul>
          {%- for neqDataSetIndex in range(neqDataSetsCount - 1) -%}
            {%- set pathPrefix = join([neqDataSetsPath, neqDataSetIndex], ".") -%}
            {%- set neqDataSetsName = repliesMap[join([pathPrefix, neqDataSetsNameQUuid], ".")].value.value -%}
            {%- set neqDataSetsDesc = repliesMap[join([pathPrefix, neqDataSetsDescQUuid], ".")].value.value -%}
            <li>
              <strong>{{ neqDataSetsName ? neqDataSetsName : "(no name given)" }}</strong>
              {% if neqDataSetsDesc -%}<span class="separator">&ndash;</span> {{ neqDataSetsDesc }}{%- endif -%}
            </li>
          {%- endfor -%}
          </ul>
        {%- endif -%}
      </p>
      </div>
    {%- endif -%}
    {%- endscope -%}
  {%- endif -%}

  {%- set preexistingPath = join([reusingCUuid, preexistingQUuid], ".") -%}
  {%- set preexistingAUuid = repliesMap[preexistingPath].value.value -%}
  {%- if preexistingAUuid == preexistingYesAUuid -%}
    {%- set usingPreexistingPath = join([preexistingPath, preexistingYesAUuid, usingPreexistingQUuid], ".") -%}
    {%- set usingPreexistingAUuid = repliesMap[usingPreexistingPath].value.value -%}
    {%- if usingPreexistingAUuid == usingPreexistingYesAUuid -%}
      {%- set refDataPath = join([usingPreexistingPath, usingPreexistingYesAUuid, refDataQUuid], ".") -%}
      {%- set refDataCount = repliesMap[refDataPath].value.value -%}
      {%- set nrefDataPath = join([usingPreexistingPath, usingPreexistingYesAUuid, nrefDataQUuid], ".") -%}
      {%- set nrefDataCount = repliesMap[nrefDataPath].value.value -%}
      {%- if (refDataCount + nrefDataCount) > 0 -%}
        <div>
          <h4>Re-used datasets</h4>
          {%- if refDataCount > 0 -%}
            <div>We will use the following reference datasets:
            <ul>
              {%- for refDataIndex in range(refDataCount - 1) -%}
                {%- set refDataPrefix = join([refDataPath, refDataIndex], ".") -%}
                {%- set refDataNameReply = repliesMap[join([refDataPrefix, refDataNameQUuid], ".")] -%}
                {%- set refDataWhere = repliesMap[join([refDataPrefix, refDataWhereQUuid], ".")].value.value -%}
                <li>
                  {# identification #}
                  <strong>{{ integrationValue(refDataNameReply, refDataNameQUuid) }}</strong>
                  {%- if refDataWhere -%}
                    {%- if (slice(refDataWhere, 0, 7) == "http://") || (slice(refDataWhere, 0, 8) == "https://") || (slice(refDataWhere, 0, 6) == "ftp://") %}
                      (<a href="{{ refDataWhere }}" target="_blank">{{ refDataWhere }}</a>)
                    {%- else %}
                      ({{ refDataWhere }})
                    {%- endif -%}
                  {%- endif -%}
                  {# version #}
                  {%- set refDataVersionedPath = join([refDataPrefix, refDataVersionedQUuid], ".") -%}
                  {%- set refDataVersionedAUuid = repliesMap[refDataVersionedPath].value.value -%}
                  {%- if refDataVersionedAUuid == refDataVersionedYesAUuid -%}
                    {%- set refDataVersionedWhichPath = join([refDataVersionedPath, refDataVersionedYesAUuid, refDataVersionedWhichQUuid], ".") -%}
                    {%- set refDataVersionedWhich = repliesMap[refDataVersionedWhichPath].value.value -%}
                    {%- set refDataVersionedChangePath = join([refDataVersionedPath, refDataVersionedYesAUuid, refDataVersionedChangeQUuid], ".") -%}
                    {%- set refDataVersionedChangeAUuid = repliesMap[refDataVersionedChangePath].value.value -%}
                    {%- if refDataVersionedWhich || refDataVersionedChangeAUuid  %}
                      <p>
                      {% if refDataVersionedWhich -%}
                        We will use version "{{ refDataVersionedWhich }}" of this dataset.
                      {%- endif -%}
                      {%- if refDataVersionedChangeAUuid == refDataVersionedChangeStayAUuid %}
                        If a new version becomes available during the project, we will stay with the old version.
                      {%- elif refDataVersionedChangeAUuid == refDataVersionedChangeNewAUuid %}
                        If a new version becomes available during the project, new analyses will be done with the new version.
                      {%- elif refDataVersionedChangeAUuid == refDataVersionedChangeAllAUuid %}
                        If a new version becomes available during the project, all analyses will be redone with the new version.
                      {%- endif -%}
                      </p>
                    {%- endif -%}
                  {%- endif -%}
                </li>
              {%- endfor -%}
            </ul>
            </div>
          {%- endif -%}
          {%- if nrefDataCount > 0 -%}
            <div>We will use the following already existing non-reference datasets:
            <ul>
              {%- for nrefDataIndex in range(nrefDataCount - 1) -%}
                {%- set nrefDataNamePath = join([nrefDataPath, nrefDataIndex, nrefDataNameQUuid], ".") -%}
                {%- set nrefDataNameReply = repliesMap[nrefDataNamePath] -%}
                {%- set nrefDataWhere = repliesMap[join([nrefDataPrefix, nrefDataWhereQUuid], ".")].value.value -%}
                <li>
                  {# identification #}
                  <strong>{{ integrationValue(nrefDataNameReply, nrefDataNameQUuid) }}</strong>
                  {%- if nrefDataWhere -%}
                    {%- if (slice(nrefDataWhere, 0, 7) == "http://") || (slice(nrefDataWhere, 0, 8) == "https://") || (slice(nrefDataWhere, 0, 6) == "ftp://") %}
                      (<a href="{{ nrefDataWhere }}" target="_blank">{{ nrefDataWhere }}</a>)
                    {%- else %}
                      ({{ nrefDataWhere }})
                    {%- endif -%}
                  {%- endif -%}
                  {# data access #}
                  {%- set nrefDataAccessPath = join([nrefDataPath, nrefDataIndex, nrefDataAccessQUuid], ".") -%}
                  {%- set nrefDataAccessAUuid = repliesMap[nrefDataAccessPath].value.value -%}
                  {%- if nrefDataAccessAUuid %}
                    <p>
                    {% if nrefDataAccessAUuid == nrefDataAccessHaveCopyAUuid -%}
                      We already have a copy of this dataset.
                    {%- elif nrefDataAccessAUuid == nrefDataAccessWillDownloadAUuid -%}
                      We will download or get a copy.
                    {%- elif nrefDataAccessAUuid == nrefDataAccessWillOnlineAUuid -%}
                      We will use its online version without downloading it.
                    {%- endif -%}
                    </p>
                  {%- endif -%}
                </li>
              {%- endfor -%}
            </ul>
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}
    {%- endif -%}
  {%- endif -%}
<hr>

  {# Format/Type with volume #}
  {%- set formatsTypesUuid = "b08fe063-33f8-4380-b3a9-ba1e586dedf2" -%}
  {%- call (reply) withReply(formatsTypesUuid) -%}
    {%- set nFormats = reply.value.value -%}
    {%- if nFormats > 0 -%}
      <p>We will be using the following file formats and types:
      <ul>
        {% for i in range(nFormats - 1) %}
          <li>
            {%- set pathPrefix = formatsTypesUuid ~ "." ~ i ~ "." -%}
            {%- set formatNameUuid = "f00cf643-5368-458a-97d4-b463c2000c66" -%}
            {%- set isFormatStandardUuid = "ecff019a-d4e6-44c6-a8fe-c84eb15ed8b7" -%}
            {%- set isFormatStandardYesUuid = "d4ce2c56-b3df-4013-9220-289b28f922de" -%}
            {%- set isFormatStandardNoUuid = "52b7aba3-d809-4a30-b3f8-90caa7a32a10" -%}
            {%- set whyNonStandardUuid = "8bd3d76a-4f69-4a1e-82dd-5416739720b3" -%}
            {%- set thereIsNoStandardUuid = "2da70314-879e-46f5-a1da-2794d71a12d3" -%}
            {%- set itIsOptimizedUuid = "6c26d57b-468c-42ba-a01c-05d1334d0a6e" -%}
            {%- set anotherReasonUuid = "ab19f42e-6204-409e-aa6d-6d87783cce44" -%}
            {%- set theReasonUuid = "ea7420ef-3de3-4ca8-9ff8-ac1cdb0e506f" -%}
            {%- set isLongTermSuitableUuid = "ced5a7c2-4034-4763-a1d5-3cb815cdfddb" -%}
            {%- set isLongTermSuitableNoUuid = "86e547b8-e3ae-44b2-89ad-3a0d67decc56" -%}
            {%- set convertLongTermSuitableUuid = "bf32374c-b24e-4b03-9898-a753cff56fcf" -%}
            {%- set convertLongTermSuitableYesUuid = "7d8dc2f5-2699-4fb3-8bf6-e620868a0583" -%}
            {%- set convertLongTermSuitableNoUuid = "3159d107-d322-4126-958f-900fc011eeae" -%}
            {%- set isLongTermSuitableYesUuid = "985e488d-257f-479d-8113-5dcbe105a08e" -%}
            {%- set volumeUuid = "ba9e42fc-2bf5-413f-85de-003f981aaf81" -%}
            {%- set volumeSmallUuid = "7d3857a2-bb7d-4355-b2ca-bd6beb7cc3ea" -%}
            {%- set volumeTotalUuid = "c2bc3d0b-a11b-4831-bd2c-5235dbf868b7" -%}
            {%- set volumeTotalGBUuid = "4ae6452a-4ca6-434c-8453-7e3872e41847" -%}
            {%- set volumeFileSizeUuid = "24dbd191-2d0c-4267-b858-d9063b21a486" -%}
            {%- set volumeFilesUuid = "448403e9-578b-4155-9017-d4aa9119ea6a" -%}
            {%- set volumeFileGBUuid = "624cfadf-6177-47b7-9ba8-b80b68aef0fd" -%}
            {%- call (xreplies) mapReplies([
              pathPrefix ~ formatNameUuid,
              pathPrefix ~ isFormatStandardUuid,
              pathPrefix ~ isFormatStandardUuid ~ "." ~ isFormatStandardNoUuid ~ "." ~ whyNonStandardUuid,
              pathPrefix ~ isFormatStandardUuid ~ "." ~ isFormatStandardNoUuid ~ "." ~ whyNonStandardUuid ~ "." ~ theReasonUuid,
              pathPrefix ~ isLongTermSuitableUuid,
              pathPrefix ~ isLongTermSuitableUuid ~ "." ~ isLongTermSuitableNoUuid ~ "." ~ convertLongTermSuitableUuid,
              pathPrefix ~ volumeUuid,
              pathPrefix ~ volumeUuid ~ "." ~ volumeTotalUuid ~ "." ~ volumeTotalGBUuid,
              pathPrefix ~ volumeUuid ~ "." ~ volumeFileSizeUuid ~ "." ~ volumeFilesUuid,
              pathPrefix ~ volumeUuid ~ "." ~ volumeFileSizeUuid ~ "." ~ volumeFileGBUuid
              ]) -%}
              {%- set formatNameReply = xreplies[0][0].value.value -%}
              {%- set isFormatStandardAnswerUuid = xreplies[1][0].value.value -%}
              {%- set whyNonStandardAnswerUuid = xreplies[2][0].value.value -%}
              {%- set theReasonText = xreplies[3][0].value.value -%}
              {%- set isLongTermSuitableAnswerUuid = xreplies[4][0].value.value -%}
              {%- set convertLongTermSuitableAnswerUuid = xreplies[5][0].value.value -%}
              {%- set volumeAnswerUuid = xreplies[6][0].value.value -%}
              {%- set volumeTotalGBNumber = xreplies[7][0].value.value -%}
              {%- set volumeFilesNumber = xreplies[8][0].value.value -%}
              {%- set volumeFileGBNumber = xreplies[9][0].value.value -%}

              {%- if formatNameReply.type == "IntegrationValue" -%}
                {%- call (integration) getIntegrationForQuestion(formatNameUuid) -%}
                  {%- call (integrationLink) createIntegrationLink(integration, formatNameReply.id) -%}
                    <a href="{{ integrationLink }}" target="_blank"><strong>{{ formatNameReply.value }}</strong></a>
                  {%- endcall -%}
                {%- endcall -%}
              {%- else -%}
                <strong>{{ formatNameReply.value }}</strong>
              {%- endif -%}

              {%- if isFormatStandardAnswerUuid || isLongTermSuitableAnswerUuid || volumeAnswerUuid -%}
                <p>
                  {# Format standard #}
                  {%- if isFormatStandardAnswerUuid == isFormatStandardYesUuid %}
                    It is not a standardized format.
                  {%- elif isFormatStandardAnswerUuid == isFormatStandardNoUuid -%}
                    {%- if whyNonStandardAnswerUuid == thereIsNoStandardUuid %}
                      It is not a standardized format because there is no standardized format for this data type.
                    {%- elif whyNonStandardAnswerUuid == itIsOptimizedUuid %}
                      It is not a standardized format but it is optimized for processing speed and/or volume.
                    {%- elif whyNonStandardAnswerUuid == anotherReasonUuid && theReasonText %}
                      It is not a standardized format. {{ theReasonText }}{{ endswith(theReasonText, ".") ? "" : "." }}
                    {%- endif -%}
                  {%- endif -%}
                  {# Format suitable #}
                  {%- if isLongTermSuitableAnswerUuid == isLongTermSuitableYesUuid %}
                    This is a suitable format for long-term archiving.
                  {%- elif isLongTermSuitableAnswerUuid == isLongTermSuitableNoUuid %}
                    {%- if convertLongTermSuitableAnswerUuid == convertLongTermSuitableYesUuid %}
                      This is not a suitable format for long-term archiving; however, we plan to convert it to a suitable format before the end of the project.
                    {%- elif convertLongTermSuitableAnswerUuid == convertLongTermSuitableNoUuid %}
                      We are aware that this is not a suitable format for long-term archiving.
                    {%- endif -%}
                  {%- endif -%}
                  {# Volume #}
                  {%- if volumeAnswerUuid == volumeSmallUuid %}
                    We will have only a small amount of data stored in this format.
                  {%- elif volumeAnswerUuid == volumeTotalUuid && volumeTotalGBNumber %}
                    We expect to have {{ volumeTotalGBNumber }} GB of data in this format.
                  {%- elif volumeAnswerUuid == volumeFileSizeUuid && volumeFilesNumber && volumeFileGBNumber %}
                      We expect to have {{ volumeFilesNumber }} files of average size {{ volumeFileGBNumber }} GB (i.e. approximatelly {{ volumeFilesNumber * volumeFileGBNumber }} GB in total). 
                  {%- endif -%}
                </p>
              {%- endif -%}
            {%- endcall -%}
          </li>
        {%- endfor -%}
      </ul>
      </p>
    {%- endif -%}
  {%- endcall -%}
  </div>
  {%- endscope -%}
</div>
